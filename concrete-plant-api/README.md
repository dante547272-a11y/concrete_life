# æ··å‡åœŸæ…æ‹Œç«™ç®¡ç†ç³»ç»Ÿ - åç«¯API

åŸºäºNestJS + Prisma + SQLiteçš„æ··å‡åœŸæ…æ‹Œç«™ç®¡ç†ç³»ç»Ÿåç«¯æœåŠ¡ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- npm >= 8.0.0

### å®‰è£…å’Œå¯åŠ¨

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

**Linux/macOS:**
```bash
cd concrete-plant-api
./scripts/start.sh
```

**Windows:**
```cmd
cd concrete-plant-api
scripts\start.bat
```

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd concrete-plant-api

# 2. å®‰è£…ä¾èµ–
npm install

# 3. åˆå§‹åŒ–æ•°æ®åº“
npm run db:init

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run start:dev
```

### é»˜è®¤ç™»å½•ä¿¡æ¯

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`

## ğŸ“Š æ•°æ®åº“ç®¡ç†

### å¸¸ç”¨å‘½ä»¤

```bash
# ç”ŸæˆPrismaå®¢æˆ·ç«¯
npm run db:generate

# æ¨é€æ•°æ®åº“æ¶æ„ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
npm run db:push

# åˆ›å»ºè¿ç§»æ–‡ä»¶
npm run db:migrate

# åˆå§‹åŒ–æ•°æ®åº“ï¼ˆæ¨é€æ¶æ„ + ç§å­æ•°æ®ï¼‰
npm run db:init

# é‡ç½®æ•°æ®åº“ï¼ˆæ¸…ç©º + é‡æ–°åˆå§‹åŒ–ï¼‰
npm run db:reset

# æ‰“å¼€Prisma Studioï¼ˆæ•°æ®åº“å¯è§†åŒ–å·¥å…·ï¼‰
npm run db:studio

# è¿è¡Œç§å­è„šæœ¬
npm run db:seed
```

### æ•°æ®åº“æ¶æ„

ç³»ç»Ÿä½¿ç”¨SQLiteæ•°æ®åº“ï¼ŒåŒ…å«ä»¥ä¸‹ä¸»è¦æ¨¡å—ï¼š

- **åŸºç¡€ç®¡ç†**: ç«™ç‚¹ã€ç”¨æˆ·ã€è§’è‰²ç®¡ç†
- **è®¾å¤‡ç®¡ç†**: è½¦è¾†ã€æ…æ‹Œæœºã€æ–™ä»“ç­‰è®¾å¤‡ç®¡ç†
- **è®¢å•ä»»åŠ¡**: è®¢å•ç®¡ç†ã€ä»»åŠ¡æ´¾å•ã€æ’é˜Ÿç®¡ç†
- **ç‰©æ–™ç®¡ç†**: åŸææ–™ã€åº“å­˜ã€é…æ–¹ç®¡ç†
- **ç”Ÿäº§æ§åˆ¶**: ç”Ÿäº§æ‰¹æ¬¡ã€é…æ–™è®°å½•
- **è´¨é‡è¿½æº¯**: è´¨é‡æ£€æµ‹ã€è®¡è´¹ç®¡ç†
- **æ—¥å¿—å‘Šè­¦**: æ“ä½œæ—¥å¿—ã€å‘Šè­¦ç®¡ç†
- **ç³»ç»Ÿé…ç½®**: å‚æ•°é…ç½®ã€æ•°æ®å­—å…¸
- **ç»Ÿè®¡åˆ†æ**: ç”Ÿäº§ç»Ÿè®¡ã€è®¾å¤‡ç»Ÿè®¡

## ğŸ”§ å¼€å‘

### é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app.module.ts          # ä¸»åº”ç”¨æ¨¡å—
â”œâ”€â”€ app.controller.ts      # ä¸»æ§åˆ¶å™¨
â”œâ”€â”€ app.service.ts         # ä¸»æœåŠ¡
â”œâ”€â”€ database/              # æ•°æ®åº“æ¨¡å—
â”‚   â”œâ”€â”€ database.module.ts
â”‚   â””â”€â”€ database.service.ts
â”œâ”€â”€ redis/                 # Redisæ¨¡å—
â””â”€â”€ prisma/               # Prismaé…ç½®
    â””â”€â”€ schema.prisma     # æ•°æ®åº“æ¨¡å‹å®šä¹‰

scripts/
â”œâ”€â”€ init-database.ts      # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ start.sh             # Linux/macOSå¯åŠ¨è„šæœ¬
â””â”€â”€ start.bat            # Windowså¯åŠ¨è„šæœ¬
```

### ç¯å¢ƒé…ç½®

å¤åˆ¶ `.env.example` åˆ° `.env` å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®ï¼š

```env
# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3001

# SQLiteæ•°æ®åº“
DATABASE_URL="file:./dev.db"

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d

# CORSé…ç½®
CORS_ORIGIN=http://localhost:5173,http://localhost:5174
```

### APIç«¯ç‚¹

- **å¥åº·æ£€æŸ¥**: `GET /health`
- **APIå¥åº·æ£€æŸ¥**: `GET /api/health`

## ğŸ› ï¸ è„šæœ¬è¯´æ˜

### æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

`scripts/init-database.ts` ä¼šåˆ›å»ºä»¥ä¸‹åˆå§‹æ•°æ®ï¼š

- **3ä¸ªé»˜è®¤ç«™ç‚¹**: æ­å·æ€»ç«™ã€å®æ³¢åˆ†ç«™ã€æ¸©å·åˆ†ç«™
- **5ä¸ªç³»ç»Ÿè§’è‰²**: è¶…çº§ç®¡ç†å‘˜ã€ç«™ç‚¹ç®¡ç†å‘˜ã€ç”Ÿäº§æ“ä½œå‘˜ã€è°ƒåº¦å‘˜ã€å¸æœº
- **1ä¸ªç®¡ç†å‘˜ç”¨æˆ·**: admin/admin123
- **14é¡¹æ•°æ®å­—å…¸**: ç”¨æˆ·ç±»å‹ã€è®¾å¤‡ç±»å‹ã€åŸææ–™ç±»å‹ç­‰
- **6ä¸ªæ··å‡åœŸç­‰çº§**: C15-C40
- **12ç§åŸææ–™**: éª¨æ–™ã€ç²‰æ–™ã€å¤–åŠ å‰‚ã€æ°´
- **11å°è®¾å¤‡**: æ…æ‹Œè½¦ã€æ…æ‹Œæœºã€æ–™ä»“ã€è®¡é‡ç§¤
- **5ä¸ªç­–ç•¥**: å«æ°´ç‡è¡¥å¿ã€åè½åº¦çŸ«æ­£ã€æ¸©åº¦è¡¥å¿ç­‰

### å¯åŠ¨è„šæœ¬åŠŸèƒ½

å¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. æ£€æŸ¥Node.jsç¯å¢ƒ
2. åˆ›å»º.envæ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
3. å®‰è£…npmä¾èµ–
4. ç”ŸæˆPrismaå®¢æˆ·ç«¯
5. æ¨é€æ•°æ®åº“æ¶æ„
6. æ£€æŸ¥å¹¶åˆå§‹åŒ–æ•°æ®åº“
7. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

## ğŸ“ å¼€å‘å‘½ä»¤

```bash
# å¼€å‘
npm run start:dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆçƒ­é‡è½½ï¼‰
npm run start:debug        # å¯åŠ¨è°ƒè¯•æ¨¡å¼

# æ„å»º
npm run build              # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run start:prod         # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

# ä»£ç è´¨é‡
npm run lint               # ä»£ç æ£€æŸ¥
npm run format             # ä»£ç æ ¼å¼åŒ–

# æµ‹è¯•
npm test                   # è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:watch         # ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:cov           # ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
npm run test:e2e           # è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### Prisma Studio

Prisma Studioæ˜¯ä¸€ä¸ªå¯è§†åŒ–æ•°æ®åº“ç®¡ç†å·¥å…·ï¼š

```bash
npm run db:studio
```

è®¿é—® http://localhost:5555 æŸ¥çœ‹å’Œç¼–è¾‘æ•°æ®åº“æ•°æ®ã€‚

### å¥åº·æ£€æŸ¥

è®¿é—®ä»¥ä¸‹ç«¯ç‚¹æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š

- http://localhost:3001/health
- http://localhost:3001/api/health

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "status": "ok",
  "timestamp": "2024-01-21T10:30:00.000Z",
  "service": "concrete-plant-api",
  "version": "1.0.0",
  "database": {
    "status": "healthy",
    "database": "connected",
    "timestamp": "2024-01-21T10:30:00.000Z"
  },
  "statistics": {
    "sites": 3,
    "users": 1,
    "equipment": 11,
    "orders": 0,
    "tasks": 0,
    "materials": 12
  }
}
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :3001
   # æˆ–ä¿®æ”¹.envä¸­çš„PORTé…ç½®
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
   npm run db:reset
   ```

3. **Prismaå®¢æˆ·ç«¯ç‰ˆæœ¬ä¸åŒ¹é…**
   ```bash
   # é‡æ–°ç”Ÿæˆå®¢æˆ·ç«¯
   npm run db:generate
   ```

4. **ä¾èµ–å®‰è£…å¤±è´¥**
   ```bash
   # æ¸…é™¤ç¼“å­˜é‡æ–°å®‰è£…
   rm -rf node_modules package-lock.json
   npm install
   ```

### æ—¥å¿—æŸ¥çœ‹

å¼€å‘æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢å’Œé”™è¯¯ä¿¡æ¯éƒ½ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚