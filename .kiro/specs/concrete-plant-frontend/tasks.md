# Implementation Plan: 混凝土搅拌站管控平台前端

## Overview

本实现计划采用增量开发方式，从项目初始化开始，逐步构建工业可视化组件、页面和功能模块。优先实现生产中控大屏，然后是管理功能页面。

## Tasks

- [x] 1. 项目初始化与基础配置
  - [x] 1.1 创建 Vite + React + TypeScript 项目
    - 使用 `npm create vite@latest` 创建项目
    - 配置 TypeScript 严格模式
    - 设置路径别名 (@/)
    - _Requirements: 15.1_

  - [x] 1.2 安装和配置依赖
    - 安装 Ant Design 5 并配置深色主题
    - 安装 Tailwind CSS
    - 安装 React Router 6
    - 安装 Zustand, TanStack Query, Socket.io-client
    - 安装 ECharts + echarts-for-react
    - _Requirements: 2.5, 3.4_

  - [x] 1.3 配置全局样式和主题
    - 创建工业风格 CSS 变量
    - 配置 Ant Design 深色主题 token
    - 设置全局字体和基础样式
    - _Requirements: 2.5_

- [ ] 2. 布局与路由
  - [x] 2.1 创建应用布局组件
    - 实现 AppLayout 组件 (侧边栏 + 头部 + 内容区)
    - 实现 Sidebar 导航菜单
    - 实现 Header 用户信息和操作
    - _Requirements: 2.1, 2.2, 2.3, 2.4_

  - [x] 2.2 配置路由
    - 设置 React Router 路由配置
    - 实现路由守卫 (认证检查)
    - 配置路由懒加载
    - _Requirements: 1.4, 2.2_

- [ ] 3. 认证模块
  - [x] 3.1 实现认证状态管理
    - 创建 authStore (Zustand)
    - 实现 token 存储和刷新逻辑
    - _Requirements: 1.2, 1.4_

  - [x] 3.2 实现登录页面
    - 创建登录表单 UI
    - 实现登录 API 调用
    - 处理登录成功/失败
    - _Requirements: 1.1, 1.2, 1.3_

  - [ ] 3.3 实现 API 客户端
    - 配置 Axios 实例
    - 添加请求/响应拦截器
    - 处理 401/403 错误
    - _Requirements: 1.4, 1.5_

- [x] 4. Checkpoint - 基础框架完成
  - 确保登录流程正常工作
  - 确保路由守卫正常工作

- [x] 5. 工业可视化组件 - 基础
  - [x] 5.1 创建骨料仓组件 (AggregateBin)
    - 绘制梯形仓体 SVG
    - 实现填充动画 (库存百分比)
    - 实现出料动画
    - 实现告警状态样式
    - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

  - [x] 5.2 创建水泥仓组件 (CementSilo)
    - 绘制圆柱形仓体 SVG
    - 实现填充动画
    - 实现出料动画
    - _Requirements: 5.1, 5.2, 5.3, 5.4_

  - [x] 5.3 创建称重斗组件 (Scale)
    - 显示目标值和实际值
    - 显示偏差百分比
    - 实现偏差超限警告样式
    - _Requirements: 4.6, 5.5, 6.3, 6.4_

  - [x] 5.4 创建搅拌机组件 (Mixer)
    - 绘制搅拌机 SVG
    - 实现叶片旋转动画
    - 显示搅拌时间进度
    - 实现出料门状态
    - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

  - [x] 5.5 创建液体罐组件 (Tank)
    - 绘制罐体 SVG
    - 显示液位
    - 实现泵运行状态
    - _Requirements: 6.1, 6.2_

- [x] 6. Checkpoint - 工业组件完成
  - 在 Storybook 中验证所有组件
  - 确保动画效果流畅

- [-] 7. 生产中控大屏
  - [x] 7.1 创建设备状态 Store
    - 实现 plantStore (Zustand)
    - 定义设备状态类型
    - _Requirements: 3.4_

  - [x] 7.2 实现 WebSocket 连接
    - 创建 useWebSocket hook
    - 处理连接/断开事件
    - 处理设备状态更新事件
    - _Requirements: 3.4, 3.5_

  - [x] 7.3 创建大屏布局
    - 实现整体布局结构
    - 排列骨料仓组
    - 排列水泥仓组
    - 放置搅拌机
    - _Requirements: 3.1, 3.2_

  - [x] 7.4 实现当前任务信息栏
    - 显示任务号、混凝土等级、方量
    - 显示车牌号
    - 显示连接状态
    - _Requirements: 8.1, 8.5_

  - [x] 7.5 实现配方表组件
    - 显示材料列表
    - 显示目标值、实际值、偏差
    - 偏差超限高亮
    - _Requirements: 8.2, 8.3, 8.4_

  - [ ] 7.6 实现生产记录列表
    - 显示最近生产记录
    - 自动滚动到最新
    - 支持筛选
    - _Requirements: 9.1, 9.2, 9.3, 9.4_

- [x] 8. Checkpoint - 中控大屏完成
  - 验证实时数据更新
  - 验证动画效果
  - 验证告警显示

- [x] 9. 告警系统
  - [x] 9.1 创建告警状态 Store
    - 实现 alarmStore (Zustand)
    - 管理告警列表
    - _Requirements: 16.3_

  - [x] 9.2 实现告警通知组件
    - 创建通知弹窗
    - 实现音频告警
    - _Requirements: 16.1, 16.2_

  - [x] 9.3 实现告警列表面板
    - 显示未确认告警
    - 支持确认操作
    - 显示告警历史
    - _Requirements: 16.3, 16.4, 16.5_

- [x] 10. 车辆管理页面
  - [x] 10.1 实现车辆列表
    - 创建数据表格
    - 实现搜索和筛选
    - 实现分页
    - _Requirements: 10.1, 10.4_

  - [x] 10.2 实现车辆表单
    - 创建新增/编辑表单
    - 实现表单验证
    - _Requirements: 10.2_

  - [x] 10.3 实现车辆状态显示
    - 状态徽章组件
    - 删除确认
    - _Requirements: 10.3, 10.5_

- [x] 11. 司机管理页面
  - [x] 11.1 实现司机列表
    - 创建数据表格
    - 显示资质状态
    - 高亮过期资质
    - _Requirements: 11.1, 11.2_

  - [x] 11.2 实现司机表单
    - 创建新增/编辑表单
    - 实现表单验证
    - _Requirements: 11.3_

- [x] 12. 订单管理页面
  - [x] 12.1 实现订单列表
    - 创建数据表格
    - 实现状态筛选
    - 实现日期范围筛选
    - _Requirements: 12.1, 12.5_

  - [x] 12.2 实现订单表单
    - 创建新增订单表单
    - 实现表单验证
    - _Requirements: 12.2_

  - [x] 12.3 实现订单状态流转
    - 状态徽章显示
    - 状态转换操作
    - 历史时间线
    - _Requirements: 12.3, 12.4_

- [x] 13. 任务派单页面
  - [x] 13.1 实现任务列表
    - 创建数据表格
    - 显示关联订单和车辆
    - _Requirements: 13.1_

  - [x] 13.2 实现车辆分配
    - 车辆选择对话框
    - 显示可用车辆和司机
    - _Requirements: 13.2, 13.3_

  - [x] 13.3 实现任务状态时间线
    - 显示状态变更历史
    - 显示位置信息
    - _Requirements: 13.4_

- [x] 14. 车辆排队看板
  - [x] 14.1 实现排队看板布局
    - 卡片式队列显示
    - 显示车辆信息
    - _Requirements: 14.1, 14.2_

  - [x] 14.2 实现实时更新
    - WebSocket 队列更新
    - 高亮当前装车
    - 显示等待时间
    - _Requirements: 14.3, 14.4, 14.5_

- [x] 15. Checkpoint - 管理页面完成
  - 验证所有 CRUD 操作
  - 验证表单验证
  - 验证状态流转

- [-] 16. 响应式优化
  - [x] 16.1 桌面端优化
    - 优化 1920x1080 布局
    - 优化大屏显示
    - _Requirements: 15.1, 15.4_
          开卡礼；/
  - [ ] 16.2 平板端适配
    - 简化布局
    - 调整组件大小
    - _Requirements: 15.2, 15.3_

- [x] 17. 最终测试与优化
  - [x] 17.1 性能优化
    - 组件懒加载
    - 虚拟滚动 (长列表)
    - WebSocket 消息节流

  - [x] 17.2 E2E 测试
    - 登录流程测试
    - 主要业务流程测试

- [x] 18. Final Checkpoint - 前端完成
  - 确保所有功能正常
  - 确保响应式布局正常
  - 确保实时数据正常

## Notes

- 优先完成生产中控大屏，这是核心功能
- 工业可视化组件使用 SVG 绘制，确保清晰度
- 深色主题适合工控环境，减少眼睛疲劳
- WebSocket 断线重连机制很重要
- 告警音效需要用户交互后才能播放 (浏览器限制)

