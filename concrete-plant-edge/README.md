# æ··å‡åœŸæ…æ‹Œç«™è¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸ºæ··å‡åœŸæ…æ‹Œç«™è®¾è®¡çš„è¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹ï¼Œæä¾›æœ¬åœ°PLCè®¾å¤‡æ§åˆ¶ã€æ•°æ®é‡‡é›†ã€å®‰å…¨ç›‘æ§å’Œäº‘ç«¯åŒæ­¥åŠŸèƒ½ã€‚

## ä¸»è¦åŠŸèƒ½

### ğŸ”Œ PLCé€šä¿¡
- **Modbus TCP/RTU**: æ”¯æŒæ ‡å‡†Modbusåè®®é€šä¿¡
- **OPC-UA**: æ”¯æŒå·¥ä¸šæ ‡å‡†OPC-UAåè®®
- **Ethernet/IP**: æ”¯æŒAllen-Bradleyç­‰è®¾å¤‡é€šä¿¡
- **å¤šè®¾å¤‡è¿æ¥**: åŒæ—¶è¿æ¥å¤šä¸ªPLCè®¾å¤‡

### ğŸ“Š æ•°æ®é‡‡é›†
- **å®æ—¶æ•°æ®**: æ¯ç§’é‡‡é›†è®¾å¤‡è¿è¡Œæ•°æ®
- **å†å²æ•°æ®**: è‡ªåŠ¨å­˜å‚¨å†å²è¶‹åŠ¿æ•°æ®
- **æ•°æ®è´¨é‡**: ç›‘æ§æ•°æ®è´¨é‡å’Œé€šä¿¡çŠ¶æ€
- **æœ¬åœ°å­˜å‚¨**: SQLiteæœ¬åœ°æ•°æ®åº“å­˜å‚¨

### ğŸ­ ç”Ÿäº§æ§åˆ¶
- **é…æ–¹ç®¡ç†**: æœ¬åœ°é…æ–¹å­˜å‚¨å’Œç®¡ç†
- **ç”Ÿäº§ä»»åŠ¡**: è‡ªåŠ¨åŒ–ç”Ÿäº§æµç¨‹æ§åˆ¶
- **é…æ–™æ§åˆ¶**: ç²¾ç¡®çš„ææ–™é…æ–™æ§åˆ¶
- **æ…æ‹Œæ§åˆ¶**: æ…æ‹Œæ—¶é—´å’Œé€Ÿåº¦æ§åˆ¶

### ğŸ›¡ï¸ å®‰å…¨ç›‘æ§
- **å®‰å…¨è§„åˆ™**: å¯é…ç½®çš„å®‰å…¨æ£€æŸ¥è§„åˆ™
- **ç´§æ€¥åœæœº**: è‡ªåŠ¨å’Œæ‰‹åŠ¨ç´§æ€¥åœæœº
- **å‘Šè­¦ç®¡ç†**: å¤šçº§åˆ«å‘Šè­¦ç³»ç»Ÿ
- **å®‰å…¨äº‹ä»¶**: å®Œæ•´çš„å®‰å…¨äº‹ä»¶è®°å½•

### ğŸ”„ äº‘ç«¯åŒæ­¥
- **ç¦»çº¿è¿è¡Œ**: ç½‘ç»œæ–­å¼€æ—¶æœ¬åœ°è‡ªä¸»è¿è¡Œ
- **æ•°æ®åŒæ­¥**: ç½‘ç»œæ¢å¤æ—¶è‡ªåŠ¨åŒæ­¥æ•°æ®
- **è¿œç¨‹æ§åˆ¶**: æ”¯æŒäº‘ç«¯è¿œç¨‹æ§åˆ¶æŒ‡ä»¤
- **çŠ¶æ€ä¸ŠæŠ¥**: å®æ—¶è®¾å¤‡çŠ¶æ€ä¸ŠæŠ¥

### ğŸ“± æœ¬åœ°ç•Œé¢
- **Webç•Œé¢**: æœ¬åœ°Webç›‘æ§ç•Œé¢
- **å®æ—¶ç›‘æ§**: è®¾å¤‡çŠ¶æ€å®æ—¶æ˜¾ç¤º
- **æ“ä½œæ§åˆ¶**: æœ¬åœ°ç”Ÿäº§æ“ä½œæ§åˆ¶
- **æ•°æ®æŸ¥çœ‹**: å†å²æ•°æ®å’ŒæŠ¥è¡¨æŸ¥çœ‹

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹æ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Webç•Œé¢å±‚    â”‚ æœ¬åœ°ç›‘æ§ç•Œé¢ â”‚ APIæ¥å£ â”‚ WebSocketé€šä¿¡      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸šåŠ¡é€»è¾‘å±‚   â”‚ ç”Ÿäº§æ§åˆ¶ â”‚ å®‰å…¨ç›‘æ§ â”‚ å‘Šè­¦ç®¡ç† â”‚ æ•°æ®é‡‡é›†   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€šä¿¡å±‚       â”‚ Modbus â”‚ OPC-UA â”‚ Ethernet/IP â”‚ äº‘ç«¯åŒæ­¥    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚       â”‚ SQLiteæœ¬åœ°æ•°æ®åº“ â”‚ é…ç½®ç®¡ç† â”‚ æ—¥å¿—ç³»ç»Ÿ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¡¬ä»¶å±‚       â”‚ PLCè®¾å¤‡ â”‚ ä¼ æ„Ÿå™¨ â”‚ æ‰§è¡Œå™¨ â”‚ ç½‘ç»œè®¾å¤‡        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Node.js**: 18.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm**: 9.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ“ä½œç³»ç»Ÿ**: Windows 10/11, Ubuntu 20.04+, CentOS 7+

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <repository-url>
   cd concrete-plant-edge
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   ```

3. **é…ç½®ç¯å¢ƒ**
   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“å’ŒPLCè¿æ¥å‚æ•°
   ```

4. **åˆå§‹åŒ–æ•°æ®åº“**
   ```bash
   npm run db:init
   ```

5. **å¯åŠ¨æœåŠ¡**
   
   **Linux/macOS:**
   ```bash
   npm run start:linux
   # æˆ–è€…
   chmod +x scripts/start.sh
   ./scripts/start.sh
   ```
   
   **Windows:**
   ```bash
   npm run start:windows
   # æˆ–è€…
   scripts/start.bat
   ```

### å¼€å‘æ¨¡å¼

```bash
# å¼€å‘æ¨¡å¼å¯åŠ¨ï¼ˆçƒ­é‡è½½ï¼‰
npm run start:dev

# è°ƒè¯•æ¨¡å¼å¯åŠ¨
npm run start:debug

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# ç”Ÿäº§æ¨¡å¼å¯åŠ¨
npm run start:prod
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ (.env)

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL="file:./data/edge.db"

# ç«™ç‚¹ä¿¡æ¯
SITE_ID="1"
SITE_NAME="æ­å·æ€»ç«™"
SITE_CODE="HZ001"

# ä¸­å¤®æœåŠ¡å™¨é…ç½®
CENTRAL_SERVER_URL="http://localhost:3001"
API_KEY="edge-node-api-key-123456"

# PLCè¿æ¥é…ç½®
MODBUS_HOST="192.168.1.100"
MODBUS_PORT="502"
OPCUA_ENDPOINT="opc.tcp://192.168.1.101:4840"

# æœåŠ¡é…ç½®
PORT="3000"
LOG_LEVEL="info"
```

### PLCè®¾å¤‡é…ç½®

åœ¨ `src/config/plc.config.ts` ä¸­é…ç½®PLCè®¾å¤‡è¿æ¥å‚æ•°ï¼š

```typescript
export const plcConfig = {
  modbus: {
    host: process.env.MODBUS_HOST || '192.168.1.100',
    port: parseInt(process.env.MODBUS_PORT) || 502,
    timeout: 5000,
    retryDelay: 1000,
  },
  opcua: {
    endpoint: process.env.OPCUA_ENDPOINT || 'opc.tcp://192.168.1.101:4840',
    securityMode: 'None',
    securityPolicy: 'None',
  },
  ethernetip: {
    host: process.env.ETHERNETIP_HOST || '192.168.1.102',
    slot: 0,
  },
};
```

## APIæ¥å£

### åŸºç¡€æ¥å£

- `GET /api/dashboard` - è·å–ä»ªè¡¨æ¿æ•°æ®
- `GET /api/realtime` - è·å–å®æ—¶æ•°æ®
- `GET /api/equipment/status` - è·å–è®¾å¤‡çŠ¶æ€

### ç”Ÿäº§æ§åˆ¶

- `GET /api/production/status` - è·å–ç”Ÿäº§çŠ¶æ€
- `POST /api/production/start/:taskId` - å¯åŠ¨ç”Ÿäº§ä»»åŠ¡
- `POST /api/production/pause` - æš‚åœç”Ÿäº§
- `POST /api/production/resume` - æ¢å¤ç”Ÿäº§
- `POST /api/production/stop` - åœæ­¢ç”Ÿäº§
- `POST /api/production/emergency-stop` - ç´§æ€¥åœæœº

### å®‰å…¨ç®¡ç†

- `GET /api/safety/status` - è·å–å®‰å…¨çŠ¶æ€
- `POST /api/safety/emergency-stop` - æ‰§è¡Œç´§æ€¥åœæœº
- `POST /api/safety/reset-emergency-stop` - é‡ç½®ç´§æ€¥åœæœº

### å‘Šè­¦ç®¡ç†

- `GET /api/alarm/active` - è·å–æ´»è·ƒå‘Šè­¦
- `GET /api/alarm/history` - è·å–å‘Šè­¦å†å²
- `POST /api/alarm/acknowledge/:id` - ç¡®è®¤å‘Šè­¦
- `POST /api/alarm/resolve/:id` - è§£å†³å‘Šè­¦

### æ•°æ®åŒæ­¥

- `GET /api/sync/status` - è·å–åŒæ­¥çŠ¶æ€
- `POST /api/sync/trigger` - æ‰‹åŠ¨è§¦å‘åŒæ­¥

## WebSocketäº‹ä»¶

### å®¢æˆ·ç«¯ç›‘å¬äº‹ä»¶

- `realtime-data` - å®æ—¶æ•°æ®æ¨é€
- `alarm` - å‘Šè­¦æ¨é€
- `system-status` - ç³»ç»ŸçŠ¶æ€æ¨é€
- `config-updated` - é…ç½®æ›´æ–°æ¨é€

### å®¢æˆ·ç«¯å‘é€äº‹ä»¶

- `control-command` - å‘é€æ§åˆ¶æŒ‡ä»¤
- `config-update` - æ›´æ–°é…ç½®

## æ•°æ®åº“ç®¡ç†

### å¸¸ç”¨å‘½ä»¤

```bash
# ç”ŸæˆPrismaå®¢æˆ·ç«¯
npm run db:generate

# æ¨é€æ•°æ®åº“ç»“æ„
npm run db:push

# åˆå§‹åŒ–æ•°æ®åº“æ•°æ®
npm run db:init

# é‡ç½®æ•°æ®åº“
npm run db:reset

# æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢
npm run db:studio
```

### æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
cp data/edge.db data/edge.db.backup

# æ¢å¤æ•°æ®åº“
cp data/edge.db.backup data/edge.db
```

## éƒ¨ç½²æ–¹æ¡ˆ

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t concrete-edge .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name concrete-edge \
  -p 3000:3000 \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/logs:/app/logs \
  --restart unless-stopped \
  concrete-edge
```

### ç³»ç»ŸæœåŠ¡éƒ¨ç½²

**Linux (systemd):**

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/concrete-edge.service`:

```ini
[Unit]
Description=Concrete Plant Edge Node
After=network.target

[Service]
Type=simple
User=concrete
WorkingDirectory=/opt/concrete-edge
ExecStart=/usr/bin/node dist/main.js
Restart=always
RestartSec=10
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl enable concrete-edge
sudo systemctl start concrete-edge
```

## ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç®¡ç†

- **åº”ç”¨æ—¥å¿—**: `logs/edge-node.log`
- **é”™è¯¯æ—¥å¿—**: `logs/error.log`
- **è®¿é—®æ—¥å¿—**: `logs/access.log`

### æ€§èƒ½ç›‘æ§

- **ç³»ç»Ÿèµ„æº**: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
- **ç½‘ç»œçŠ¶æ€**: PLCè¿æ¥çŠ¶æ€ã€äº‘ç«¯è¿æ¥çŠ¶æ€
- **ä¸šåŠ¡æŒ‡æ ‡**: ç”Ÿäº§æ•ˆç‡ã€å‘Šè­¦é¢‘ç‡ã€æ•°æ®è´¨é‡

### ç»´æŠ¤ä»»åŠ¡

- **æ•°æ®æ¸…ç†**: è‡ªåŠ¨æ¸…ç†30å¤©å‰çš„å†å²æ•°æ®
- **æ—¥å¿—è½®è½¬**: è‡ªåŠ¨å‹ç¼©å’Œæ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
- **å¥åº·æ£€æŸ¥**: å®šæœŸæ£€æŸ¥ç³»ç»Ÿå’ŒæœåŠ¡çŠ¶æ€

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **PLCè¿æ¥å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒIPåœ°å€é…ç½®
   - ç¡®è®¤PLCè®¾å¤‡æ”¯æŒç›¸åº”åè®®
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

2. **æ•°æ®åº“é”™è¯¯**
   - æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
   - è¿è¡Œ `npm run db:reset` é‡ç½®æ•°æ®åº“
   - æ£€æŸ¥ç£ç›˜ç©ºé—´

3. **äº‘ç«¯åŒæ­¥å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯APIå¯†é’¥é…ç½®
   - æŸ¥çœ‹åŒæ­¥çŠ¶æ€å’Œé”™è¯¯æ—¥å¿—

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è°ƒè¯•æ—¥å¿—
export LOG_LEVEL=debug
npm run start:dev

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
npm run start:debug
```

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ plc/                    # PLCé€šä¿¡æ¨¡å—
â”‚   â”œâ”€â”€ modbus/            # Modbusé€šä¿¡
â”‚   â”œâ”€â”€ opcua/             # OPC-UAé€šä¿¡
â”‚   â””â”€â”€ ethernet-ip/       # Ethernet/IPé€šä¿¡
â”œâ”€â”€ production/            # ç”Ÿäº§æ§åˆ¶æ¨¡å—
â”œâ”€â”€ safety/                # å®‰å…¨ç›‘æ§æ¨¡å—
â”œâ”€â”€ alarm/                 # å‘Šè­¦ç®¡ç†æ¨¡å—
â”œâ”€â”€ monitoring/            # ç³»ç»Ÿç›‘æ§æ¨¡å—
â”œâ”€â”€ sync/                  # æ•°æ®åŒæ­¥æ¨¡å—
â”œâ”€â”€ web/                   # Webæ¥å£æ¨¡å—
â””â”€â”€ database/              # æ•°æ®åº“æ¨¡å—
```

### æ·»åŠ æ–°åŠŸèƒ½

1. åˆ›å»ºæ–°çš„æ¨¡å—ç›®å½•
2. å®ç°æœåŠ¡ç±»å’Œæ§åˆ¶å™¨
3. åœ¨ `app.module.ts` ä¸­æ³¨å†Œæ¨¡å—
4. æ·»åŠ ç›¸åº”çš„æ•°æ®åº“æ¨¡å‹
5. ç¼–å†™å•å…ƒæµ‹è¯•

### ä»£ç è§„èŒƒ

- ä½¿ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼
- éµå¾ªESLintå’ŒPrettieré…ç½®
- ç¼–å†™å®Œæ•´çš„JSDocæ³¨é‡Š
- ä¿æŒå•ä¸€èŒè´£åŸåˆ™

## è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤Issueã€‚